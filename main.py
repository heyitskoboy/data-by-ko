# ทำไมต้องมี: เรียกใช้ไลบรารี pandas สำหรับจัดการข้อมูลแบบตาราง
# ทำงานยังไง: นำเข้าแพ็กเกจ pandas และให้ชื่อย่อว่า pd จะได้พิมพ์ง่ายๆ
import pandas as pd

# ทำไมต้องมี: เพื่อนำข้อมูลจากไฟล์ CSV เข้ามาวิเคราะห์ในโปรแกรม
# ทำงานยังไง: คำสั่ง read_csv จะอ่านไฟล์ sales_data.csv และแปลงเป็นตารางเก็บในตัวแปร df (DataFrame)
df = pd.read_csv('sales_data.csv')

print("=== 1. ตรวจสอบคุณภาพข้อมูล (Verify Data Quality) ===")

# ทำไมต้องมี: เพื่อดูว่าคอลัมน์ไหนมีข้อมูลแหว่งหายไปบ้าง [cite: 15]
# ทำงานยังไง: เช็คค่าว่าง (isnull) แล้วนับจำนวน (sum) ในแต่ละคอลัมน์
print("\n[ตรวจสอบ Missing Value]")
print(df.isnull().sum())

# ทำไมต้องมี: เพื่อดูว่ามีรายการสั่งซื้อไหนที่บันทึกซ้ำซ้อนกันหรือไม่ [cite: 17]
# ทำงานยังไง: หาแถวที่ข้อมูลเหมือนกันทุกประการ (duplicated) แล้วนับจำนวน (sum)
print("\n[ตรวจสอบข้อมูลซ้ำ]")
print("จำนวนข้อมูลซ้ำ:", df.duplicated().sum(), "แถว")

# ทำไมต้องมี: เพื่อเช็คว่าชนิดข้อมูลถูกต้องพร้อมเอาไปคำนวณไหม [cite: 18]
# ทำงานยังไง: แสดงประเภทข้อมูลของแต่ละคอลัมน์ออกมา
print("\n[ตรวจสอบชนิดข้อมูล]")
print(df.dtypes)


print("\n\n=== 2. ทำความสะอาดข้อมูล (Data Cleaning) ===")

# ทำไมต้องมี: เพื่อกำจัดข้อมูลที่ซ้ำซ้อนกันออกไป ทำให้ยอดขายไม่เพี้ยน [cite: 23]
# ทำงานยังไง: ลบแถวที่ซ้ำกันทิ้ง และอัปเดตทับข้อมูลเดิมทันที (inplace=True)
df.drop_duplicates(inplace=True)

# ทำไมต้องมี: เพื่อแก้ไขข้อมูลผิดรูปแบบ เช่น ใส่จำนวนติดลบ หรือราคาติดลบ ซึ่งเป็นไปไม่ได้ [cite: 22]
# ทำงานยังไง: กรองเอาเฉพาะข้อมูลที่ Quantity และ Unit Price มีค่ามากกว่า 0
df = df[(df['Quantity'] > 0) & (df['Unit Price'] > 0)]

# ทำไมต้องมี: เพื่อจัดรูปแบบวันที่ให้ถูกต้อง จะได้นำไปหายอดขายรวมต่อเดือนได้ [cite: 24]
# ทำงานยังไง: แปลงข้อมูลคอลัมน์ Date เป็นรูปแบบวันที่ (Datetime) หากเจอตัวอักษรแปลกๆ ให้เปลี่ยนเป็นค่าว่าง (errors='coerce')
df['Date'] = pd.to_datetime(df['Date'], errors='coerce')

# ทำไมต้องมี: หลังจากแปลงวันที่แล้ว อาจเกิดค่าว่าง (NaT) จากแถวที่วันที่ผิดรูปแบบ จึงต้องลบทิ้ง
# ทำงานยังไง: ลบแถวที่มีค่าว่าง (Missing Value) ออกจากตาราง [cite: 21]
df.dropna(inplace=True)

# ทำไมต้องมี: เพื่อตรวจสอบผลลัพธ์ว่าข้อมูลสะอาดและพร้อมใช้งานแล้วหรือยัง
# ทำงานยังไง: พิมพ์ข้อมูลทั้งหมดที่เหลืออยู่ออกมาดู
print("\n[ข้อมูลหลังทำความสะอาดเสร็จสิ้น]")
print(df)

print("\n\n=== 3. วิเคราะห์ข้อมูล (Data Analysis) ===")

# ทำไมต้องมี: ตอนนี้เรามีแค่ 'จำนวน' (Quantity) กับ 'ราคาต่อหน่วย' (Unit Price) ต้องสร้างคอลัมน์ 'ยอดขายรวม' ก่อน
# ทำงานยังไง: นำคอลัมน์ Quantity มาคูณกับ Unit Price แล้วเก็บไว้ในคอลัมน์ใหม่ชื่อ Total_Sales
df['Total_Sales'] = df['Quantity'] * df['Unit Price']

# 3.1 หายอดขายรวมต่อเดือน
print("\n[ยอดขายรวมต่อเดือน]")
# ทำไมต้องมี: เพื่อดูเทรนด์ว่าเดือนไหนขายดี
# ทำงานยังไง: ดึง 'เดือน' ออกมาจากคอลัมน์ Date (dt.to_period('M')) สร้างเป็นคอลัมน์ใหม่ชื่อ Month
df['Month'] = df['Date'].dt.to_period('M')
# จากนั้นจัดกลุ่มตาม 'Month' (groupby) แล้วหาผลรวม (sum) เฉพาะคอลัมน์ Total_Sales
monthly_sales = df.groupby('Month')['Total_Sales'].sum()
print(monthly_sales)

# 3.2 วิเคราะห์สินค้าขายดีที่สุด 5 อันดับ
print("\n[สินค้าขายดีที่สุด 5 อันดับ]")
# ทำไมต้องมี: เพื่อดูว่าสินค้าไหนสร้างรายได้หลักให้บริษัท
# ทำงานยังไง: จัดกลุ่มตาม 'Product Name' แล้วหาผลรวมของ 'Quantity' 
# จากนั้นเรียงลำดับจากมากไปน้อย (sort_values) และเลือกมา 5 อันดับแรก (head(5))
# ข้อสังเกต: ข้อมูลจำลองเรามีแค่ 4 ชิ้น โปรแกรมก็จะแสดงเท่าที่มีครับ
top_products = df.groupby('Product Name')['Quantity'].sum().sort_values(ascending=False).head(5)
print(top_products)

# 3.3 วิเคราะห์ยอดขายตามภูมิภาค
print("\n[ยอดขายตามภูมิภาค]")
# ทำไมต้องมี: เพื่อดูว่าสาขาในภูมิภาคไหนทำยอดได้ดีที่สุด
# ทำงานยังไง: จัดกลุ่มตาม 'Region' แล้วหาผลรวมของ 'Total_Sales'
# จากนั้นเรียงลำดับจากมากไปน้อย (sort_values)
region_sales = df.groupby('Region')['Total_Sales'].sum().sort_values(ascending=False)
print(region_sales)

# ทำไมต้องมี: เรียกใช้ไลบรารีสำหรับสร้างกราฟ (Visualisation)
# ทำงานยังไง: matplotlib ใช้สร้างโครงกราฟ และ seaborn ช่วยให้กราฟสวยงามและใช้งานง่ายขึ้น
import matplotlib.pyplot as plt
import seaborn as sns

# ตั้งค่าสไตล์ของกราฟ
sns.set_theme(style="whitegrid")

# 5.1 กราฟยอดขายรายเดือน (Line Chart)
plt.figure(figsize=(10, 5)) # กำหนดขนาดรูปกราฟ
# ทำไมต้องมี: เพื่อแสดงแนวโน้ม (Trend) ของยอดขายในแต่ละช่วงเวลา [cite: 37, 148]
# ทำงานยังไง: นำข้อมูลยอดขายรายเดือนที่คำนวณไว้มาสร้างกราฟเส้น
monthly_sales.plot(kind='line', marker='o', color='b')
plt.title('Monthly Total Sales') # ตั้งชื่อกราฟ
plt.ylabel('Sales Amount (Baht)') # ชื่อแกน Y
plt.show() # แสดงผลกราฟ

# 5.2 กราฟเปรียบเทียบภูมิภาค (Bar Chart)
plt.figure(figsize=(8, 5))
# ทำไมต้องมี: เพื่อให้เห็นภาพชัดเจนว่าภูมิภาคไหนทำยอดได้มากกว่ากัน [cite: 39, 148]
# ทำงานยังไง: ใช้ seaborn สร้างกราฟแท่ง (Barplot) จากข้อมูลภูมิภาค
sns.barplot(x=region_sales.index, y=region_sales.values, palette='viridis')
plt.title('Sales by Region Comparison')
plt.ylabel('Total Sales')
plt.show()